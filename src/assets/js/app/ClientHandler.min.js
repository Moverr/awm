
"use strict";var ClientHandler=function(){ClientHandler.self=this;clientList.addEntityChangedEventListenerCallback(ClientHandler.prototype.entityChanged);$("#singleClientActions a").on("click touch",ClientHandler.self._singleClientActionHandler)};ClientHandler.ALL_CLIENTS_TITLES={fullname:"Name",gender:"Sex",birthdate:"Birth date",submitDate:"Registration",phone1:"Phone",account:"Balance",loan:"Loan"};ClientHandler.ACCOUNTS_TITLES={accountNo:"Account",type:"Type",status:"Status",interestRate:"Interest rate p.a.",balance:"Balance"};ClientHandler.prototype.getAll=function(){addHistory("All clients","#clients",getSidebarSubitemSelector("reporting","Client","getAll"));currentTable="allClients";ClientHandler.self.previousPage=ClientHandler.self.getAll;ClientHandler.self.displayClients()};ClientHandler.prototype.loadClients=function(){clientList.reload()};ClientHandler.prototype.displayClients=function(){ClientHandler.self.currentClient=null;initDefaultContent("All clients");$("#syncNow").off("click touch");$("#syncNow").on("click touch",ClientHandler.self.synchronizeNow);$("#syncNow").show();$("#printNow").off("click touch");$("#printNow").on("click touch",printData);$("#printNow").show();$("#sendclientEmailReportBotton").off("click touch");$("#sendclientEmailReportBotton").on("click touch",ClientHandler.self.sendEmailLoanReportRequest);$("#sendclientEmailReportBotton").show();var n=clientList.getEntities();var r=getDefaultRowContainer(ClientHandler.ALL_CLIENTS_TITLES);var q=r.parent();for(var g=0;g<n.length;g++){var s={};for(var o in ClientHandler.ALL_CLIENTS_TITLES){var f=n[g][o];if("birthdate"===o||"submitDate"===o){f=formatDate(f)}if("account"===o){var b=savingsAccountList.getByClient(n[g]["awamoId"]);var m=b.length;if(m>0){var l=0;for(var d=0;d<m;d++){var a=b[d];l=l+a.balance}f=currencyCode+" "+formatCurrency(l)}else{f=currencyCode+" "+0}}if("loan"===o){var h=loanList.getByClient(n[g]["awamoId"]);var m=h.length;if(m>0){var l=0;for(var d=0;d<m;d++){var e=h[d];if(e.status==="ACTIVE"){l=l+e.principal}}f=currencyCode+" "+formatCurrency(l)}else{f=currencyCode+" "+0}}if(f===" "){f="n.a."}s[o]=f}addRow(r,s,n[g],ClientHandler.self.rowClickHandler,n[g].accountId)}var k=getDefaultTableSorter();k.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};q.tablesorter(k);var c=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var g=0;g<c.length;g++){c[g].style.textAlign="right"}$("#tableTotal").text(n.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));var p=$("#defaultTableContainer").tableExport();p.tableExport.update({formats:["xls","xlsx"],fileName:"Clients",headings:true});$("#hiddenPrintedTitle").val("Clients Report")};ClientHandler.prototype.rowClickHandler=function(){ClientHandler.self.displayOneClient($(this).data("object"))};ClientHandler.prototype.displayOneClient=function(a){if(!exists(a)){return}ClientHandler.self.client=a;initDefaultContent("Client");ClientHandler.self.displayClientData(a);ClientHandler.self.displayAccountsData(a);showContent($("#accountsTableContainer"));showContent($("#client"))};ClientHandler.prototype.displayClientData=function(a){document.getElementById("clientImageID").src="images/personPlaceholderNoText.png";$("#client .panel-heading").text(a.fullname);$("#clientAwamoId").val(a.awamoId);$("#clientFirstName").val(a.firstname);$("#clientMiddleName").val(a.middlename);$("#clientLastName").val(a.lastname);$("#clientBirthdate").val(formatDate(a.birthdate)+" ("+a.age+" years)");$("#clientNationality").val(a.nationality);$("#clientSubmitdate").val(formatDate(a.submitDate));$.ajax({url:host+"/client/v1d/find?awamoId="+a.awamoId+"&deviceId=cockpit&datatype=PHOTOGRAPHY",type:"GET",headers:getAuthenticationHeader(),xhrFields:{responseType:"arraybuffer"}}).done(function(d){var c=new Blob([d],{type:"image/jpg"});var b=new FileReader();b.onload=function(f){document.getElementById("clientImageID").src=f.target.result};b.readAsDataURL(c)}).fail(function(b){document.getElementById("clientImageID").src="images/personPlaceholderNoText.png";console.log("fail");console.log(b)});$("#clientIdDocumentType").val(a.iddocumenttype);$("#clientIdDocument").val(a.iddocument);$("#clientPhone1").val(a.phone1);$("#clientPhone2").val(a.phone2);$("#clientGender").val(a.gender);$("#clientLocation").val(a.site)};ClientHandler.prototype.displayAccountsData=function(c){var j=getRowContainer("#accountsTableContainer",ClientHandler.ACCOUNTS_TITLES);var h=j.parent();var b=savingsAccountList.getByClient(c.awamoId);var f=b.length;for(var d=0;d<f;d++){var a=b[d];var g=ClientHandler.prototype._getAccountsRowData(a);addRow(j,g,a,ClientHandler.self._accountsRowClickHandler,a.accountId)}var e=getDefaultTableSorter();e.headers={3:{sorter:"awamoPercentageSorter"},4:{sorter:"awamoCurrencySorter"}};h.tablesorter(e);addClassToTableColumn(h,3,"percentage");addClassToTableColumn(h,4,"currency")};ClientHandler.prototype._getAccountsRowData=function(c){var d={};for(var a in ClientHandler.ACCOUNTS_TITLES){var b=c[a];switch(a){case"type":b="savings account";break;case"interestRate":b=formatPercentage(b)+" %";break;case"balance":b=formatCurrency(b)+" "+currencyCode;break;default:break}d[a]=String(b)}return d};ClientHandler.prototype._accountsRowClickHandler=function(){var b=$(this).data("object");var c=handlers.SavingsAccount;var a={currentTarget:{}};$(a.currentTarget).data("object",b);c.rowClickHandler(a,function(){ClientHandler.self.displayOneClient(ClientHandler.self.client)})};ClientHandler.prototype._singleClientActionHandler=function(a){a.preventDefault();hideContent();switch($(this).data("action")){case"back":ClientHandler.self.previousPage();break;default:break}};ClientHandler.prototype.outputClient=function(b){var a=null;var c=clientList.getTotalCount();if("allClients"===currentTable){}else{}return a};ClientHandler.prototype.entityChanged=function(a){ClientHandler.self.outputClient(a)};ClientHandler.prototype.synchronizeNow=function(){clientList.reload()};ClientHandler.prototype.sendEmailLoanReportRequest=function(){var c={tenantId:tenantId};var b="/tenant/v1d/mis/reportEmail";var a='{"startTime":"0","endTime":"0","reportEmailEntity":"CLIENT","reportEmailType":"ALL","email":"'+$("#emailReportC").val()+'"}';ajax(b,"POST",ClientHandler.prototype.emailReportResponseHandler,a,c,ClientHandler.prototype.emailReportFailedResponseHandler)};ClientHandler.prototype.emailReportResponseHandler=function(a){message("Success","Message Sent Successfully",MessageType.SUCCESS)};ClientHandler.prototype.emailReportFailedResponseHandler=function(a){message("Error",a.responseJSON.message,MessageType.WARNING)};ClientHandler.prototype.getAllClientsForLoanApplication=function(){$("html, body").animate({scrollTop:0},"fast");addHistory("All clients","#clients",getSidebarSubitemSelector("reporting","Client","getAll"));currentTable="allClientsLoanApplication";ClientHandler.self.previousPage=ClientHandler.self.getAll;ClientHandler.self.displayClientsForLoanApplication()};ClientHandler.prototype.displayClientsForLoanApplication=function(){ClientHandler.self.currentClient=null;initDefaultContent("Select a client to start creating a loan application");$("#syncNow").off("click touch");$("#syncNow").on("click touch",ClientHandler.self.synchronizeNow);$("#syncNow").show();var n=clientList.getEntities();var q=getDefaultRowContainer(ClientHandler.ALL_CLIENTS_TITLES);var p=q.parent();for(var g=0;g<n.length;g++){var r={};for(var o in ClientHandler.ALL_CLIENTS_TITLES){var f=n[g][o];if("birthdate"===o||"submitDate"===o){f=formatDate(f)}if("account"===o){var b=savingsAccountList.getByClient(n[g]["awamoId"]);var m=b.length;if(m>0){var l=0;for(var d=0;d<m;d++){var a=b[d];l=l+a.balance}f=currencyCode+" "+formatCurrency(l)}else{f=currencyCode+" "+0}}if("loan"===o){var h=loanList.getByClient(n[g]["awamoId"]);var m=h.length;if(m>0){var l=0;for(var d=0;d<m;d++){var e=h[d];if(e.status==="ACTIVE"){l=l+e.principal}}f=currencyCode+" "+formatCurrency(l)}else{f=currencyCode+" "+0}}if(f===" "){f="n.a."}r[o]=f}addRow(q,r,n[g],ClientHandler.self.rowClickHandlerClientsForLoanApplication,n[g].accountId)}var k=getDefaultTableSorter();k.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};p.tablesorter(k);var c=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var g=0;g<c.length;g++){c[g].style.textAlign="right"}$("#tableTotal").text(n.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));$("#hiddenPrintedTitle").val("Select a client to start creating a loan application")};ClientHandler.prototype.rowClickHandlerClientsForLoanApplication=function(){Options.prototype.createLoanApplication($(this).data("object"))};