
"use strict";var currentChangedFil="ALL";var SavingsAccountHandler=function(){SavingsAccountHandler.self=this;savingsAccountList.addDataModelChangedEventListenerCallback(SavingsAccountHandler.prototype.dataModelChanged);savingsAccountList.addEntityChangedEventListenerCallback(SavingsAccountHandler.prototype.entityChanged);$("#SavingsAccountReportTypeForm select").on("input",SavingsAccountHandler.prototype.genericSavingAccountReportSelectHandler);SavingsAccountHandler.self.goBackHandler=null};SavingsAccountHandler.ROOT_PATH="/savingsaccount/v1d/";SavingsAccountHandler.APPLICATION_TITLES={clientName:"Name",accountNo:"Account",status:"Status",interestRate:"Interest rate p.a.",balance:"Balance"};SavingsAccountHandler.ALL_ACCOUNTS_TITLES={clientName:"Name",accountNo:"Account",status:"Status",interestRate:"Interest rate p.a.",balance:"Balance"};SavingsAccountHandler.TRANSACTION_TITLES={transactionDate:"Date",amount:"Amount",transactionType:"Type",balance:"Balance"};SavingsAccountHandler.prototype.getApplications=function(){addHistory("Savings Account Applications","#savingsAccountApplications",getSidebarSubitemSelector("actionRequired","SavingsAccount","getApplications"));currentTable="savingsAccountApplications";SavingsAccountHandler.self.previousPage=SavingsAccountHandler.self.getApplications;SavingsAccountHandler.self.displaySavingsAccountApplications()};SavingsAccountHandler.prototype.getAll=function(){addHistory("All Savings Accounts","#savingsAccounts",getSidebarSubitemSelector("reporting","SavingsAccount","getAll"));currentTable="allSavingsAccounts";SavingsAccountHandler.self.previousPage=SavingsAccountHandler.self.getAll;SavingsAccountHandler.self.displayAllSavingsAccounts()};SavingsAccountHandler.prototype.outputAccount=function(b){var a=null;if("savingsAccountApplications"===currentTable){if(b.status==="SUBMITTED"){a=SavingsAccountHandler.self.addToTable(b)}else{}}else{if("allSavingsAccounts"===currentTable){a=SavingsAccountHandler.self.addToTable(b)}else{}}return a};SavingsAccountHandler.prototype.entityChanged=function(a){if(currentChangedFil==="ALL"){SavingsAccountHandler.self.outputAccount(a)}else{if(a.status.valueOf()===currentChangedFil){SavingsAccountHandler.self.outputAccount(a)}}};SavingsAccountHandler.prototype.dataModelChanged=function(){};SavingsAccountHandler.prototype.addToTable=function(c){var g=null;if("savingsAccountApplications"===currentTable||"allSavingsAccounts"===currentTable){var e=SavingsAccountHandler.ALL_ACCOUNTS_TITLES;if("savingsAccountApplications"===currentTable){e=SavingsAccountHandler.APPLICATION_TITLES}var h=$("#defaultTableContainer");if(h.is(":visible")){var m=h.find("table");var n=m.find("tbody");var g=n.find('[data-id="'+c.accountId+'"]');var d=g.data("object");var l=SavingsAccountHandler.prototype.getRowData(e,c);if(!exists(d)){addRow(n,l,c,SavingsAccountHandler.self.rowClickHandler,c.accountId)}else{var k=g.find("td");var f=k.length;for(var b=0;b<f;b++){var j=$(k[b]);var a=l[Object.keys(SavingsAccountHandler.ALL_ACCOUNTS_TITLES)[b]];if(j.html()!==a){j.html(a);highlightUpdatedCell(j)}}}}}};SavingsAccountHandler.prototype.displaySavingsAccountApplications=function(){SavingsAccountHandler.prototype.currentSavingsAccount=null;initDefaultContent("Savings account applications");$("#syncNow").off("click touch");$("#syncNow").on("click touch",SavingsAccountHandler.self.synchronizeNow);$("#syncNow").show();$("#printNow").off("click touch");$("#printNow").on("click touch",printData);$("#printNow").show();SavingsAccountHandler.self.removeTableFilterClasses();SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.APPLICATION_TITLES,savingsAccountList.getListByStatus("SUBMITTED"));$("#defaultTableContainer").addClass("allSavingsAccountsTable")};SavingsAccountHandler.prototype.displayAllSavingsAccounts=function(){SavingsAccountHandler.prototype.currentSavingsAccount=null;initDefaultContent("");$("#syncNow").off("click touch");$("#syncNow").on("click touch",SavingsAccountHandler.self.synchronizeNow);$("#syncNow").show();$("#printNow").off("click touch");$("#printNow").on("click touch",printData);$("#printNow").show();$("#SavingAccountReportType").show();$("#SavingsAccountReportTypeForm").show();document.getElementById("SavingAccountReportType").selectedIndex="0";SavingsAccountHandler.self.removeTableFilterClasses();SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getEntities());$("#defaultTableContainer").addClass("allSavingsAccountsTable")};SavingsAccountHandler.prototype.removeTableFilterClasses=function(){$("#defaultTableContainer").removeClass("allSavingsAccountsTable")};SavingsAccountHandler.prototype.displayInTable=function(c,f){var e=$("#defaultTableContainer");e.empty();var h=getEmptyTable(true);e.append(h);var j=h.find("thead");addRow(j,c);j=h.find("tbody");for(var b=0;b<f.length;b++){addRow(j,SavingsAccountHandler.prototype.getRowData(c,f[b]),f[b],SavingsAccountHandler.self.rowClickHandler,f[b].accountId)}var d=getDefaultTableSorter();d.headers={3:{sorter:"awamoPercentageSorter"},4:{sorter:"awamoCurrencySorter"}};h.tablesorter(d);var a=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var b=0;b<a.length;b++){a[b].style.textAlign="right"}addClassToTableColumn(h,3,"percentage");addClassToTableColumn(h,4,"currency");$("#tableTotal").text(f.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));showContent(e);e.show();$("#sendsavingaccountEmailReportBotton").off("click touch");$("#sendsavingaccountEmailReportBotton").on("click touch",SavingsAccountHandler.self.sendEmailLoanReportRequest);$("#sendsavingaccountEmailReportBotton").show();var g=$("#defaultTableContainer").tableExport();g.tableExport.update({formats:["xls","xlsx"],fileName:"SavingsAccounts",headings:true});$("#hiddenPrintedTitle").val("Savingaccounts Report")};SavingsAccountHandler.prototype.rowClickHandler=function(b,a){if(exists(a)){SavingsAccountHandler.self.previousPage=a}$("#singleActions a").off("click touch");$("#singleActions a").on("click touch",SavingsAccountHandler.prototype.singleObjectActionHandler);$("#approveNo").off("click touch");$("#approveNo").on("click touch",SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount);$("#rejectNo").off("click touch");$("#rejectNo").on("click touch",SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount);$("#closeNo").off("click touch");$("#closeNo").on("click touch",SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount);$("#approveYes").off("click touch");$("#approveYes").on("click touch",SavingsAccountHandler.prototype.approveApplication);$("#rejectYes").off("click touch");$("#rejectYes").on("click touch",SavingsAccountHandler.prototype.rejectApplication);$("#closeYes").off("click touch");$("#closeYes").on("click touch",SavingsAccountHandler.prototype.closeApplication);SavingsAccountHandler.self.displayOneSavingsAccount($(b.currentTarget).data("object"))};SavingsAccountHandler.prototype.getRowData=function(d,c){var e={};for(var a in d){var b=c[a];switch(a){case"clientImage":b='<img src="images/personPlaceholderNoText.png" alt="client" height="32" />';if("GROUP"===c.savingsAccountType){b='<img src="images/groupPlaceholder.png" alt="client" height="32" />'}else{if("INDIVIDUAL"===c.savingsAccountType){b='<img src="images/personPlaceholderNoText.png" alt="client" height="32" />'}}break;case"interestRate":b=formatPercentage(b)+" %";break;case"balance":b=formatCurrency(b)+" "+currencyCode;break;default:break}e[a]=String(b)}return e};SavingsAccountHandler.prototype.displayOneSavingsAccount=function(b){if(!exists(b)){return}SavingsAccountHandler.self.savingsAccount=b;initDefaultContent("Savings account");var a=SavingsAccountHandler.self.getRowData(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,b);$("#savingsAccountNumber").val(a.accountNo);$("#savingsAccountName").val(a.clientName);$("#savingsAccountStatus").val(a.status);$("#savingsAccountInterest").val(a.interestRate);$("#savingsAccount .balance .value").text(a.balance);SavingsAccountHandler.self.adjustSingleActionsByStatus(b.status);SavingsAccountHandler.self.displayTransactionsData(b.transactionList);showContent($("#singleActions"));showContent($("#savingsAccount"))};SavingsAccountHandler.prototype.displayTransactionsData=function(a){var f=$("#savingsAccountTransactionsTableContainer");f.empty();var h=getEmptyTable(true);f.append(h);var j=h.find("thead");addRow(j,SavingsAccountHandler.TRANSACTION_TITLES);j=h.find("tbody");if(!exists(a)){return}var e=a.length;for(var c=0;c<e;c++){var b=a[c];var g=SavingsAccountHandler.prototype.getTransactionRowData(b);addRow(j,g,b)}var d=getDefaultTableSorter();d.headers={0:{sorter:"awamoDateSorter"},1:{sorter:"awamoCurrencySorter"},3:{sorter:"awamoCurrencySorter"}};h.tablesorter(d);addClassToTableColumn(h,1,"currency");addClassToTableColumn(h,3,"currency");showContent(h)};SavingsAccountHandler.prototype.getTransactionRowData=function(c){var d={};for(var a in SavingsAccountHandler.TRANSACTION_TITLES){var b=c[a];switch(a){case"transactionDate":b=formatDate(b);break;case"amount":case"balance":b=formatCurrency(b)+" "+currencyCode;break;default:break}d[a]=String(b)}return d};SavingsAccountHandler.prototype.singleObjectActionHandler=function(a){a.preventDefault();hideContent();switch($(this).data("action")){case"back":SavingsAccountHandler.self.previousPage();break;case"approve":$("#approveApplication .panel-body .approvalObject").text("savings account");showContent($("#approveApplication"));break;case"reject":$("#rejectApplication .panel-body .rejectionObject").text("savings account");$("#rejectionNote").val("");showContent($("#rejectApplication"));break;case"close":$("#closeApplication .panel-body .closeObject").text("savings account");showContent($("#closeApplication"));break;default:break}};SavingsAccountHandler.prototype.adjustSingleActionsByStatus=function(a){$("#singleActions a[data-action]").hide();$('#singleActions a[data-action="back"]').show();switch(a){case"SUBMITTED":$('#singleActions a[data-action="approve"]').show();$('#singleActions a[data-action="reject"]').show();break;case"REJECTED":break;case"ACTIVE":$('#singleActions a[data-action="close"]').show();break;case"CLOSED":break;default:break}};SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount=function(){SavingsAccountHandler.self.displayOneSavingsAccount(SavingsAccountHandler.self.savingsAccount)};SavingsAccountHandler.prototype.approveApplication=function(){SavingsAccountHandler.self.savingsAccount.status="ACTIVE";ajax(SavingsAccountHandler.ROOT_PATH+SavingsAccountHandler.self.savingsAccount.accountId+"/approve","POST",SavingsAccountHandler.prototype.approveApplicationSuccessful)};SavingsAccountHandler.prototype.approveApplicationSuccessful=function(){SavingsAccountHandler.self.savingsAccount.status="ACTIVE";savingsAccountList.put(savingsAccountList,SavingsAccountHandler.self.savingsAccount);SavingsAccountHandler.self.previousPage()};SavingsAccountHandler.prototype.rejectApplication=function(){SavingsAccountHandler.self.savingsAccount.status="REJECTED";ajax(SavingsAccountHandler.ROOT_PATH+SavingsAccountHandler.self.savingsAccount.accountId+"/reject","POST",SavingsAccountHandler.prototype.rejectApplicationSuccessful,'{"note":"'+$("#rejectionNote").val()+'"}')};SavingsAccountHandler.prototype.rejectApplicationSuccessful=function(){SavingsAccountHandler.self.savingsAccount.status="REJECTED";savingsAccountList.put(savingsAccountList,SavingsAccountHandler.self.savingsAccount);SavingsAccountHandler.self.previousPage()};SavingsAccountHandler.prototype.closeApplication=function(){SavingsAccountHandler.self.savingsAccount.status="CLOSED";ajax(SavingsAccountHandler.ROOT_PATH+SavingsAccountHandler.self.savingsAccount.accountId+"/close","POST",SavingsAccountHandler.prototype.closeApplicationSuccessful,'{"note":"'+$("#closeNote").val()+'"}')};SavingsAccountHandler.prototype.closeApplicationSuccessful=function(){SavingsAccountHandler.self.savingsAccount.status="CLOSED";savingsAccountList.put(savingsAccountList,SavingsAccountHandler.self.savingsAccount);SavingsAccountHandler.self.previousPage()};SavingsAccountHandler.prototype.loadSavingsAccounts=function(){savingsAccountList.reload()};SavingsAccountHandler.prototype.synchronizeNow=function(){savingsAccountList.reload()};SavingsAccountHandler.prototype.sendEmailLoanReportRequest=function(){var c={tenantId:tenantId};var b="/tenant/v1d/mis/reportEmail";var a='{"startTime":"0","endTime":"0","reportEmailEntity":"SAVINGS_ACCOUNTS","reportEmailType":"ALL","email":"'+$("#emailReportC").val()+'"}';ajax(b,"POST",SavingsAccountHandler.prototype.emailReportResponseHandler,a,c,SavingsAccountHandler.prototype.emailReportFailedResponseHandler)};SavingsAccountHandler.prototype.emailReportResponseHandler=function(a){message("Success","Message Sent Successfully",MessageType.SUCCESS)};SavingsAccountHandler.prototype.emailReportFailedResponseHandler=function(a){message("Error",a.responseJSON.message,MessageType.WARNING)};SavingsAccountHandler.prototype.genericSavingAccountReportSelectHandler=function(){switch($(this).val()){case"ALL":currentChangedFil="ALL";SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getEntities());break;case"ACTIVE":currentChangedFil="ACTIVE";SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("ACTIVE"));break;case"CLOSED":currentChangedFil="CLOSED";SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("CLOSED"));break;case"SUBMITTED":currentChangedFil="SUBMITTED";SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("SUBMITTED"));break;default:break}};